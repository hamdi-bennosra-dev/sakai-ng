<div class="col-12">
    <div class="card">
        <h5>Product Models</h5>
        <p-toast></p-toast>
        <p-table #dt1 [value]="products" dataKey="name" [expandedRowKeys]="expandedRows" [globalFilterFields]="['name']"
            responsiveLayout="scroll">
            <ng-template pTemplate="caption">
                <div class="flex justify-content-between flex-column sm:flex-row">
                    <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
                        (click)="clear(dt1)"></button>
                    <span class="p-input-icon-left mb-2">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)"
                            placeholder="Search Keyword" class="w-full" />
                    </span>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 3rem"></th>
                    <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
                    <th>Image</th>
                    <th pSortableColumn="name">Brand <p-sortIcon field="brand"></p-sortIcon></th>
                    <th pSortableColumn="price">Price <p-sortIcon field="price"></p-sortIcon></th>
                    <th pSortableColumn="category">Category <p-sortIcon field="category"></p-sortIcon></th>
                    <th pSortableColumn="rating">Reviews <p-sortIcon field="rating"></p-sortIcon></th>
                    <th pSortableColumn="inventoryStatus">Status <p-sortIcon field="inventoryStatus"></p-sortIcon></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product let-expanded="expanded">
                <tr>
                    <td>
                        <button type="button" pButton pRipple [pRowToggler]="product"
                            class="p-button-text p-button-rounded p-button-plain"
                            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                            (click)="!expanded ? getProductsByModelId(product) : null"></button>
                    </td>
                    <td style="min-width: 12rem;">{{product.name}}</td>
                    <td>
                        <img class="shadow-4" [src]="product.img" [alt]="product.name" width="100" />
                    </td>
                    <td style="min-width: 12rem;">{{product.brandName?.toLowerCase()}}</td>
                    <td style="min-width: 8rem;">{{product.minPrice | currency:'USD'}} - {{product.maxPrice |
                        currency:'USD'}}</td>
                    <td style="min-width: 10rem;">{{product.type?.toLowerCase()}}</td>
                    <td style="min-width: 10rem;">
                        <!-- <p-rating [ngModel]="product.rating" [readonly]="true" [cancel]="false"></p-rating> -->
                    </td>
                    <td>
                        <span
                            [class]="'product-badge status-' + ((product.totalCount > 0) ? 'INSTOCK' : 'OUTOFSTOCK').toLowerCase()">
                            {{
                            ((product.totalCount > 0) ? 'INSTOCK' : 'OUTOFSTOCK').toLowerCase()
                            }}
                        </span>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-product>
                <tr>
                    <td colspan="12">
                        <div class="p-3">
                            <p-table [value]="product.products" dataKey="reference" responsiveLayout="scroll">
                                <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="reference">Reference<p-sortIcon field="reference"></p-sortIcon></th>
                    <th pSortableColumn="price.amount">Price<p-sortIcon field="price.amount"></p-sortIcon></th>
                    <th>Reservation</th>
                    <!-- <th pSortableColumn="amount">Amount <p-sortIcon field="amount"></p-sortIcon></th>
                    <th pSortableColumn="stats">Status <p-sortIcon field="status"></p-sortIcon></th> -->
                    <!-- <th style="width: 4rem"></th> -->
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-p>
                <tr>
                    <td>{{p.reference}}</td>
                    <td>{{p.currentPrice?.amount | currency:'USD'}}</td>
                    <td>{{ (p.reservations[0]?.loanedFrom && p.reservations[0]?.loanedUntil) ?
                        p.reservations[0]?.loanedFrom + " to " + p.reservations[0]?.loanedUntil : '' }}</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="6">There are no products for this model yet.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    </td>
    </tr>
    </ng-template>
    </p-table>
</div>
</div>